Adapted from https://reslp.github.io/blog/My-MAKER-Pipeline/

### PREPARE FOR THE SECOND MAKER RUN ###

You should be on the *.maker.output directory


Once the MAKER run from Step 1 is done it is time to train the first gene predictor SNAP with the results acquired in Step 1.
For this we need to extract the results from the first MAKER run

> gff3_merge -d sel2_NW_015504334_unziped_master_datastore_index.log

This command creates a GFF3 file containing all the preliminary gene predications created in Step 1.

We will now generate the necessary files for training SNAP:

> maker2zff sel2_NW_015504334_unziped.all.gff

This script (which comes with MAKER) will create two files: genome.ann and genome.dna which contain information about the gene sequences (such as exons and introns) as well as the actual DNA sequences.

> module load bioinfo-tools
> module load snap/2013-11-29

> fathom genome.ann genome.dna -validate > snap_validate_output.txt

*using the paper data*

- 72 genes, 72 OK, 43 warnings, 0 errors

if there are errors:

> cat snap_validate_output.txt | grep "error"

should give something like this:
scaff40651: MODEL6064 16223 17246 5 + errors(1): cds:internal_stop warnings(2): split-start exon-1:short(1)

then do:
> grep -vwE "MODEL6064" genome.ann > genome.ann2

Rerunning fathom should now show no errors:
>  fathom genome.ann2 genome.dna -validate

Now that the files are error free, lets create the remaining input files for training SNAP

> fathom genome.ann genome.dna -categorize 1000
> fathom uni.ann uni.dna -export 1000 -plus
> forge export.ann export.dna

Now we have everything ready to train SNAP with hmm-assembler (which comes with SNAP):

> hmm-assembler.pl /domus/h1/carolpb/GenomeAnalysis/data/wgs_from_paper/sel2_NW_015504334_unziped.fasta . > sel2_NW_015504334_unziped.hmm


##############

We will now link the newly created SNAP hmm file in the MAKER control file. Change the following line in the maker_opts.ctl file:

> snaphmm=/home/carolpb/GenomeAnalysis/results/6_Maker2_paper/run_1/sel2_NW_015504334_unziped.maker.output/sel2_NW_015504334_unziped.hmm #SNAP HMM file

To base the predictions in the second MAKER run only on SNAP remove the filepaths to the protein and est evidence or set the flags for est2genome=0 and protein2genome=0.


> maker





#####
After MAKER is finished repeat the above to create another set of hmms for SNAP.
This can be done several times, however beware because SNAP can also be overtrained.
